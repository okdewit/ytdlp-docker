{% set channels_dict = {} %}
{% for subscription in subscriptions %}
    {% set channel_name = subscription.get('channel', 'Unknown Channel') %}
    {% set channel_id = subscription.get('channel_id', '') %}
    {% if channel_name not in channels_dict %}
        {% set _ = channels_dict.update({channel_name: {'id': channel_id, 'subscriptions': []}}) %}
    {% endif %}
    {% set _ = channels_dict[channel_name]['subscriptions'].append(subscription) %}
{% endfor %}

{% if channels_dict %}
    <ul class="subscriptions-list">
        {% for channel_name, channel_data in channels_dict.items() %}
            <li class="channel-group">
                <div class="channel-header">
                    <div class="channel-info">
                        <div class="channel-name">{{ channel_name }}</div>
                        <div class="channel-meta">
                            {{ channel_data.subscriptions|length }} subscription{{ 's' if channel_data.subscriptions|length != 1 else '' }}
                            {% if channel_data.id %}‚Ä¢ {{ channel_data.id }}{% endif %}
                        </div>
                    </div>
                    <div class="expand-icon">‚ñ∂</div>
                </div>

                <div class="subscription-list">
                    {% for subscription in channel_data.subscriptions %}
                        <div class="subscription-item">
                            <div class="subscription-info">
                                <div class="subscription-title">
                                    {% if subscription.type == 'video' %}
                                        üé• Video: <span class="url-path">{{ subscription.url.split('/')[-1] if '/' in subscription.url else subscription.url }}</span>
                                    {% elif subscription.type == 'playlist' %}
                                        üìã Playlist: <span class="url-path">{{ subscription.url.split('/')[-1] if '/' in subscription.url else subscription.url }}</span>
                                    {% elif subscription.type == 'channel' %}
                                        üì∫ Channel: <span class="url-path">{{ subscription.url.split('/')[-1] if '/' in subscription.url else subscription.url }}</span>
                                    {% else %}
                                        üìÑ {{ subscription.type|title }}: <span class="url-path">{{ subscription.url }}</span>
                                    {% endif %}
                                </div>
                                <div class="subscription-url">{{ subscription.url }}</div>

                                <div class="subscription-status">
                                    <!-- Subscription behavior based on type -->
                                    <span class="subscription-behavior {{ subscription.type }}">
                                        {% if subscription.type == 'video' %}
                                            üéØ Single Video
                                        {% elif subscription.type == 'channel' %}
                                            üîÑ Full Channel
                                        {% elif subscription.type == 'playlist' %}
                                            üìã Playlist
                                        {% else %}
                                            {{ subscription.type|title }}
                                        {% endif %}
                                    </span>

                                    <!-- Download Status (placeholder for now) -->
                                    <span class="download-status pending">
                                        ‚è≥ Not Downloaded
                                    </span>
                                </div>
                            </div>

                            <div class="subscription-actions">
                                <button
                                    class="btn btn-primary btn-small"
                                    hx-post="/update/{{ subscription.url | urlencode }}"
                                    hx-target="#subscriptions-container"
                                    hx-swap="innerHTML"
                                    title="Download now">
                                    ‚ñ∂Ô∏è Run Now
                                </button>

                                <button
                                    class="btn btn-danger btn-small"
                                    hx-delete="/remove/{{ subscription.url | urlencode }}"
                                    hx-target="#subscriptions-container"
                                    hx-swap="innerHTML"
                                    hx-confirm="Are you sure you want to remove this subscription?"
                                    title="Remove subscription">
                                    üóëÔ∏è Remove
                                </button>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <div class="no-subscriptions">
        <h3>No subscriptions yet</h3>
        <p>Add your first YouTube URL above to get started!</p>
    </div>
{% endif %}